{"ast":null,"code":"import _defineProperty from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useContext,useEffect}from'react';import{Link}from'react-router-dom';import axios from'axios';import swal from'sweetalert';import{useHistory,useParams}from'react-router-dom';import{GlobalState}from'../../../../GlobalState';import Loading from'../../utils/loading/Loading';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var initialState={product_id:'',title:'',price:0,description:'',content:'',category:'',_id:''};var CreateProduct=function CreateProduct(){var state=useContext(GlobalState);var _state$token=_slicedToArray(state.token,1),token=_state$token[0];var _state$productsAPI$pr=_slicedToArray(state.productsAPI.products,1),products=_state$productsAPI$pr[0];var _state$categoryAPI$ca=_slicedToArray(state.categoryAPI.categories,1),categories=_state$categoryAPI$ca[0];var _state$productsAPI$ca=_slicedToArray(state.productsAPI.callback,2),callback=_state$productsAPI$ca[0],setCallback=_state$productsAPI$ca[1];var _state$userAPI$isAdmi=_slicedToArray(state.userAPI.isAdmin,1),isAdmin=_state$userAPI$isAdmi[0];var _state$productsAPI$pa=_slicedToArray(state.productsAPI.page,2),page=_state$productsAPI$pa[0],setPage=_state$productsAPI$pa[1];var _state$productsAPI$so=_slicedToArray(state.productsAPI.sort,2),sort=_state$productsAPI$so[0],setSort=_state$productsAPI$so[1];var _state$productsAPI$ca2=_slicedToArray(state.productsAPI.category,2),category=_state$productsAPI$ca2[0],setCategory=_state$productsAPI$ca2[1];var _useState=useState(initialState),_useState2=_slicedToArray(_useState,2),product=_useState2[0],setProduct=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),images=_useState4[0],setImages=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),loading=_useState6[0],setLoading=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),edit=_useState8[0],setEdit=_useState8[1];var params=useParams();var history=useHistory();useEffect(function(){setPage(10);setSort('');setCategory('');},[setPage,setSort,setCategory]);useEffect(function(){if(params.id){setEdit(true);products.forEach(function(product){if(product._id===params.id){setProduct(product);setImages(product.images);}});}else{setEdit(false);setProduct(initialState);setImages(false);}},[params,products]);var styleUpload={display:images?\"block\":\"none\"};var handleUpload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,formData,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;if(isAdmin){_context.next=4;break;}return _context.abrupt(\"return\",swal(\"Error\",\"You're not an admin.\",\"error\"));case 4:file=e.target.files[0];if(file){_context.next=7;break;}return _context.abrupt(\"return\",swal(\"Error\",\"File not exist.\",\"error\"));case 7:if(!(file.size>1024*1024)){_context.next=9;break;}return _context.abrupt(\"return\",swal(\"Error\",\"Size too large.\",\"error\"));case 9:if(!(file.type!=='image/jpeg'&&file.type!=='image/png')){_context.next=11;break;}return _context.abrupt(\"return\",swal(\"Error\",\"File format is incorrect.\",\"error\"));case 11:formData=new FormData();formData.append('file',file);setLoading(true);_context.next=16;return axios.post('/api/upload',formData,{headers:{'content-type':'multipart/form-data',Authorization:token}});case 16:res=_context.sent;setLoading(false);setImages(res.data);_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](1);swal(\"Error\",_context.t0.response.data.msg,\"error\");case 24:case\"end\":return _context.stop();}}},_callee,null,[[1,21]]);}));return function handleUpload(_x){return _ref.apply(this,arguments);};}();var handleDestroy=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(isAdmin){_context2.next=3;break;}return _context2.abrupt(\"return\",swal(\"Error\",\"You're not an admin.\",\"error\"));case 3:setLoading(true);_context2.next=6;return axios.post('/api/destroy',{public_id:images.public_id},{headers:{Authorization:token}});case 6:setLoading(false);setImages(false);_context2.next=13;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](0);swal(\"Error\",_context2.t0.response.data.msg,\"error\");case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,10]]);}));return function handleDestroy(_x2){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setProduct(_objectSpread(_objectSpread({},product),{},_defineProperty({},name,value)));};var handleSubmit=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();_context3.prev=1;if(isAdmin){_context3.next=4;break;}return _context3.abrupt(\"return\",swal(\"Error\",\"You're not an admin.\",\"error\"));case 4:if(images){_context3.next=6;break;}return _context3.abrupt(\"return\",swal(\"Error\",\"No image upload.\",\"error\"));case 6:if(!edit){_context3.next=11;break;}_context3.next=9;return axios.put(\"/api/products/\".concat(product._id),_objectSpread(_objectSpread({},product),{},{images:images}),{headers:{Authorization:token}});case 9:_context3.next=13;break;case 11:_context3.next=13;return axios.post('/api/products',_objectSpread(_objectSpread({},product),{},{images:images}),{headers:{Authorization:token}});case 13:setCallback(!callback);history.push('/admin');_context3.next=20;break;case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](1);swal(\"Error\",_context3.t0.response.data.msg,\"error\");case 20:case\"end\":return _context3.stop();}}},_callee3,null,[[1,17]]);}));return function handleSubmit(_x3){return _ref3.apply(this,arguments);};}();var deleteProduct=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id,public_id){var destroyImg,_deleteProduct;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;setLoading(true);destroyImg=axios.post('/api/destroy',{public_id:public_id},{headers:{Authorization:token}});_deleteProduct=axios.delete(\"/api/products/\".concat(id),{headers:{Authorization:token}});_context4.next=6;return destroyImg;case 6:_context4.next=8;return _deleteProduct;case 8:setCallback(!callback);setLoading(false);history.push('/admin');_context4.next=16;break;case 13:_context4.prev=13;_context4.t0=_context4[\"catch\"](0);swal(\"Error\",_context4.t0.response.data.msg,\"error\");case 16:case\"end\":return _context4.stop();}}},_callee4,null,[[0,13]]);}));return function deleteProduct(_x4,_x5){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"dash-title\",children:\"Product\"}),/*#__PURE__*/_jsx(\"div\",{className:\"dash-create\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-single\",children:/*#__PURE__*/_jsx(\"div\",{className:\"card-body\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"create-product\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"upload\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"file\",id:\"file_up\",onChange:handleUpload}),loading?/*#__PURE__*/_jsx(\"div\",{id:\"file_img\",children:/*#__PURE__*/_jsx(Loading,{})}):/*#__PURE__*/_jsxs(\"div\",{id:\"file_img\",style:styleUpload,children:[/*#__PURE__*/_jsx(\"img\",{src:images?images.url:\"\",alt:\"\"}),/*#__PURE__*/_jsx(\"span\",{onClick:handleDestroy,children:\"x\"})]})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"product_id\",children:\"Product ID\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"product_id\",id:\"product_id\",required:true,value:product.product_id,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"Title\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"title\",id:\"title\",required:true,value:product.title,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"price\",children:\"Price\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"price\",id:\"price\",required:true,value:product.price,onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description\",children:\"Description\"}),/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",name:\"description\",id:\"description\",required:true,value:product.description,rows:\"2\",onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"content\",children:\"Content\"}),/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",name:\"content\",id:\"content\",required:true,value:product.content,rows:\"3\",onChange:handleChange})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"categories\",children:\"Categories:  \"}),/*#__PURE__*/_jsxs(\"select\",{name:\"category\",value:product.category,onChange:handleChange,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Please select a category\"}),categories.map(function(category){return/*#__PURE__*/_jsx(\"option\",{value:category.name,children:category.name},category._id);})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:edit?\"Update\":\"Create\"})]})]})})})}),/*#__PURE__*/_jsx(\"section\",{className:\"recent\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"activity-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"activity-card\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Products\"}),/*#__PURE__*/_jsx(\"div\",{className:\"table-responsive\",children:/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Price\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Sold\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Image\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Category\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:products.map(function(product){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:product.title}),/*#__PURE__*/_jsx(\"td\",{children:product.price}),/*#__PURE__*/_jsx(\"td\",{children:product.sold}),/*#__PURE__*/_jsx(\"td\",{className:\"td-team\",children:/*#__PURE__*/_jsx(\"img\",{src:product.images.url,alt:\"\",className:\"img\"})}),/*#__PURE__*/_jsx(\"td\",{children:product.category}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(Link,{to:\"/admin/edit-product/\".concat(product._id),style:{marginRight:'5px'},children:\"Edit\"}),/*#__PURE__*/_jsx(Link,{to:\"/admin/create-product\",onClick:function onClick(){return deleteProduct(product._id,product.images.public_id);},children:\"Delete\"})]})]},product._id);})})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"summary\",children:/*#__PURE__*/_jsx(\"div\",{className:\"summary-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"summary-single\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"ti-id-badge\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h5\",{children:products.length}),/*#__PURE__*/_jsx(\"small\",{children:\"Number of products\"})]})]})})})]})})]});};export default CreateProduct;","map":{"version":3,"sources":["C:/Users/ASUS/Documents/React/MERN-E/client/src/components/mainpage/admin/create-product/CreateProduct.js"],"names":["React","useState","useContext","useEffect","Link","axios","swal","useHistory","useParams","GlobalState","Loading","initialState","product_id","title","price","description","content","category","_id","CreateProduct","state","token","productsAPI","products","categoryAPI","categories","callback","setCallback","userAPI","isAdmin","page","setPage","sort","setSort","setCategory","product","setProduct","images","setImages","loading","setLoading","edit","setEdit","params","history","id","forEach","styleUpload","display","handleUpload","e","preventDefault","file","target","files","size","type","formData","FormData","append","post","headers","Authorization","res","data","response","msg","handleDestroy","public_id","handleChange","name","value","handleSubmit","put","push","deleteProduct","destroyImg","delete","url","map","sold","marginRight","length"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport swal from 'sweetalert';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\n\r\nimport { GlobalState } from '../../../../GlobalState';\r\nimport Loading from '../../utils/loading/Loading';\r\n\r\nconst initialState = {\r\n  product_id: '',\r\n  title: '',\r\n  price: 0,\r\n  description: '',\r\n  content: '',\r\n  category: '',\r\n  _id: ''\r\n};\r\n\r\nconst CreateProduct = () => {\r\n  const state = useContext(GlobalState);\r\n  const [token] = state.token;\r\n  const [products] = state.productsAPI.products;\r\n  const [categories] = state.categoryAPI.categories;\r\n  const [callback, setCallback] = state.productsAPI.callback;\r\n  const [isAdmin] = state.userAPI.isAdmin;\r\n  const [page, setPage] = state.productsAPI.page;\r\n  const [sort, setSort] = state.productsAPI.sort;\r\n  const [category, setCategory] = state.productsAPI.category;\r\n\r\n  const [product, setProduct] = useState(initialState);\r\n  const [images, setImages] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [edit, setEdit] = useState(false);\r\n\r\n  const params = useParams();\r\n  const history = useHistory();\r\n\r\n  useEffect(() => {\r\n    setPage(10)\r\n    setSort('')\r\n    setCategory('')\r\n  }, [setPage, setSort, setCategory])\r\n\r\n  useEffect(() => {\r\n    if (params.id) {\r\n      setEdit(true)\r\n      products.forEach(product => {\r\n        if (product._id === params.id) {\r\n          setProduct(product)\r\n          setImages(product.images)\r\n        }    \r\n      })\r\n    } else {\r\n      setEdit(false)\r\n      setProduct(initialState)\r\n      setImages(false)\r\n    }\r\n  }, [params, products])\r\n\r\n  const styleUpload = {\r\n    display: images ? \"block\" : \"none\"\r\n  }\r\n\r\n  const handleUpload = async (e) => {\r\n    e.preventDefault()\r\n    try {\r\n      if (!isAdmin) return swal(\"Error\", \"You're not an admin.\", \"error\")\r\n      const file = e.target.files[0]\r\n\r\n      if (!file) return swal(\"Error\", \"File not exist.\", \"error\")\r\n      if (file.size > 1024 * 1024) return swal(\"Error\", \"Size too large.\", \"error\")\r\n      if (file.type !== 'image/jpeg' && file.type !== 'image/png') return swal(\"Error\", \"File format is incorrect.\", \"error\")\r\n\r\n      let formData = new FormData()\r\n      formData.append('file', file)\r\n\r\n      setLoading(true)\r\n      const res = await axios.post('/api/upload', formData, {\r\n        headers: {'content-type': 'multipart/form-data', Authorization: token}\r\n      })\r\n      setLoading(false)\r\n      setImages(res.data)\r\n    } catch (err) {\r\n      swal(\"Error\", err.response.data.msg, \"error\")\r\n    }\r\n  }\r\n\r\n  const handleDestroy = async (e) => {\r\n    try {\r\n      if (!isAdmin) return swal(\"Error\", \"You're not an admin.\", \"error\")\r\n      setLoading(true)\r\n      await axios.post('/api/destroy', {public_id: images.public_id}, {\r\n        headers: {Authorization: token}\r\n      })\r\n      setLoading(false)\r\n      setImages(false)\r\n    } catch (err) {\r\n      swal(\"Error\", err.response.data.msg, \"error\")\r\n    }\r\n  }\r\n\r\n  const handleChange = (e) => {\r\n    const {name, value} = e.target\r\n    setProduct({...product, [name]: value})\r\n  }\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault()\r\n    try {\r\n      if (!isAdmin) return swal(\"Error\", \"You're not an admin.\", \"error\")\r\n      if (!images) return swal(\"Error\", \"No image upload.\", \"error\")  \r\n      \r\n      if (edit) {\r\n        await axios.put(`/api/products/${product._id}`, {...product, images}, {\r\n          headers: {Authorization: token}\r\n        })\r\n      } else {\r\n        await axios.post('/api/products', {...product, images}, {\r\n          headers: {Authorization: token}\r\n        })  \r\n      }\r\n      setCallback(!callback)\r\n      history.push('/admin')\r\n    } catch (err) {\r\n      swal(\"Error\", err.response.data.msg, \"error\")\r\n    }\r\n  }\r\n\r\n  const deleteProduct = async (id, public_id) => {\r\n    try {\r\n      setLoading(true)\r\n      const destroyImg = axios.post('/api/destroy', {public_id}, {\r\n        headers: {Authorization: token}\r\n      })\r\n\r\n      const deleteProduct = axios.delete(`/api/products/${id}`, {\r\n        headers: {Authorization: token}\r\n      })\r\n\r\n      await destroyImg\r\n      await deleteProduct\r\n      setCallback(!callback)\r\n      setLoading(false)\r\n      history.push('/admin')\r\n    } catch (err) {\r\n      swal(\"Error\", err.response.data.msg, \"error\")\r\n    }\r\n  }\r\n\r\n  return (\r\n    <main>    \r\n      <h2 className=\"dash-title\">Product</h2>\r\n      <div className=\"dash-create\">\r\n        <div className=\"card-single\">\r\n          <div className=\"card-body\">\r\n            <div className=\"create-product\">\r\n              <div className=\"upload\">\r\n                <input type=\"file\" name=\"file\" id=\"file_up\" onChange={handleUpload} />\r\n                {\r\n                  loading ? \r\n                    <div id=\"file_img\"><Loading /></div>\r\n                  :\r\n                    <div id=\"file_img\" style={styleUpload}>\r\n                      <img src={images ? images.url : \"\"} alt=\"\"/>\r\n                      <span onClick={handleDestroy}>x</span>\r\n                    </div>\r\n                }\r\n              </div>\r\n\r\n              <form onSubmit={handleSubmit}>\r\n                <div className=\"row\">\r\n                  <label htmlFor=\"product_id\">Product ID</label>\r\n                  <input type=\"text\" name=\"product_id\" id=\"product_id\" required value={product.product_id} onChange={handleChange} />\r\n                </div>\r\n                <div className=\"row\">\r\n                  <label htmlFor=\"title\">Title</label>\r\n                  <input type=\"text\" name=\"title\" id=\"title\" required value={product.title} onChange={handleChange} />\r\n                </div>\r\n                <div className=\"row\">\r\n                  <label htmlFor=\"price\">Price</label>\r\n                  <input type=\"text\" name=\"price\" id=\"price\" required value={product.price} onChange={handleChange} />\r\n                </div>\r\n                <div className=\"row\">\r\n                  <label htmlFor=\"description\">Description</label>\r\n                  <textarea type=\"text\" name=\"description\" id=\"description\" required value={product.description} rows=\"2\" onChange={handleChange} />\r\n                </div>\r\n                <div className=\"row\">\r\n                  <label htmlFor=\"content\">Content</label>\r\n                  <textarea type=\"text\" name=\"content\" id=\"content\" required value={product.content} rows=\"3\" onChange={handleChange} />\r\n                </div>\r\n                <div className=\"row\">\r\n                  <label htmlFor=\"categories\">Categories:  </label>\r\n                  <select name=\"category\" value={product.category} onChange={handleChange}>\r\n                    <option value=\"\">Please select a category</option>\r\n                    {\r\n                      categories.map(category => (\r\n                        <option key={category._id} value={category.name}>\r\n                          {category.name}\r\n                        </option>\r\n                      ))\r\n                    }\r\n                  </select>\r\n                </div>\r\n\r\n                <button type=\"submit\">{edit ? \"Update\" : \"Create\"}</button>\r\n              </form>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <section className=\"recent\">\r\n        <div className=\"activity-grid\">\r\n          <div className=\"activity-card\">\r\n            <h3>Products</h3>\r\n              \r\n            <div className=\"table-responsive\">\r\n              <table>\r\n                <thead>\r\n                  <tr>\r\n                    <th>Name</th>\r\n                    <th>Price</th>\r\n                    <th>Sold</th>\r\n                    <th>Image</th>\r\n                    <th>Category</th>\r\n                    <th>Actions</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {\r\n                    products.map(product => (\r\n                      <tr key={product._id}>\r\n                        <td>{product.title}</td>\r\n                        <td>{product.price}</td>\r\n                        <td>{product.sold}</td>\r\n                        <td className=\"td-team\">\r\n                            <img src={product.images.url} alt=\"\" className=\"img\" />\r\n                        </td>\r\n                        <td>\r\n                          {product.category}\r\n                        </td>\r\n                        <td>\r\n                          <Link to={`/admin/edit-product/${product._id}`} style={{marginRight: '5px'}}>Edit</Link>\r\n                          <Link to=\"/admin/create-product\" onClick={() => deleteProduct(product._id, product.images.public_id)}>Delete</Link>\r\n                        </td>\r\n                      </tr>\r\n                    ))\r\n                  }\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"summary\">\r\n            <div className=\"summary-card\">\r\n              <div className=\"summary-single\">\r\n                <span className=\"ti-id-badge\"></span>\r\n                <div>\r\n                  <h5>{products.length}</h5>\r\n                  <small>Number of products</small>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n    </main>\r\n  )\r\n}\r\n\r\nexport default CreateProduct\r\n"]},"metadata":{},"sourceType":"module"}