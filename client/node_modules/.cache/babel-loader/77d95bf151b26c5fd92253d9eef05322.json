{"ast":null,"code":"import _objectSpread from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/ASUS/Documents/React/MERN-E/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import swal from'sweetalert';import axios from'axios';var UserAPI=function UserAPI(token){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLogged=_useState2[0],setIsLogged=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAdmin=_useState4[0],setIsAdmin=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),cart=_useState6[0],setCart=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),history=_useState8[0],setHistory=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),callback=_useState10[0],setCallback=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),infor=_useState12[0],setInfor=_useState12[1];useEffect(function(){if(token){var getUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/user/infor',{headers:{Authorization:token}});case 3:res=_context.sent;setIsLogged(true);res.data.role===1?setIsAdmin(true):setIsAdmin(false);setCart(res.data.cart);setInfor([res.data.name,res.data.mobile,res.data.address]);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);swal(\"Error\",_context.t0.response.data.msg,\"error\");case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function getUser(){return _ref.apply(this,arguments);};}();getUser();}},[token]);useEffect(function(){if(token){var getHistory=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res,_res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!isAdmin){_context2.next=7;break;}_context2.next=3;return axios.get('/api/payment',{headers:{Authorization:token}});case 3:res=_context2.sent;setHistory(res.data);_context2.next=11;break;case 7:_context2.next=9;return axios.get('/user/history',{headers:{Authorization:token}});case 9:_res=_context2.sent;setHistory(_res.data);case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function getHistory(){return _ref2.apply(this,arguments);};}();getHistory();}},[token,callback,isAdmin]);var addCart=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(product){var check;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(isLogged){_context3.next=2;break;}return _context3.abrupt(\"return\",swal(\"Fail!\",\"Please login to continue buying\",\"error\"));case 2:check=cart.every(function(item){return item._id!==product._id;});if(!check){_context3.next=9;break;}setCart([].concat(_toConsumableArray(cart),[_objectSpread(_objectSpread({},product),{},{quantity:1})]));_context3.next=7;return axios.patch('/user/addcart',{cart:[].concat(_toConsumableArray(cart),[_objectSpread(_objectSpread({},product),{},{quantity:1})])},{headers:{Authorization:token}});case 7:_context3.next=10;break;case 9:swal(\"Thank you!\",\"This product has been added to cart!\",\"info\");case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function addCart(_x){return _ref3.apply(this,arguments);};}();return{isLogged:[isLogged,setIsLogged],isAdmin:[isAdmin,setIsAdmin],cart:[cart,setCart],addCart:addCart,history:[history,setHistory],callback:[callback,setCallback],infor:[infor,setInfor]};};export default UserAPI;","map":{"version":3,"sources":["C:/Users/ASUS/Documents/React/MERN-E/client/src/api/UserAPI.js"],"names":["useState","useEffect","swal","axios","UserAPI","token","isLogged","setIsLogged","isAdmin","setIsAdmin","cart","setCart","history","setHistory","callback","setCallback","infor","setInfor","getUser","get","headers","Authorization","res","data","role","name","mobile","address","response","msg","getHistory","addCart","product","check","every","item","_id","quantity","patch"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react';\r\nimport swal from 'sweetalert';\r\nimport axios from 'axios';\r\n\r\nconst UserAPI = (token) => {\r\n  const [isLogged, setIsLogged] = useState(false);\r\n  const [isAdmin, setIsAdmin] = useState(false);\r\n  const [cart, setCart] = useState([]);\r\n  const [history, setHistory] = useState([]);\r\n  const [callback, setCallback] = useState(false);\r\n  const [infor, setInfor] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      const getUser = async () => {\r\n        try {\r\n          const res = await axios.get('/user/infor', {\r\n            headers: {Authorization: token}\r\n          })\r\n          setIsLogged(true)\r\n          res.data.role === 1 ? setIsAdmin(true) : setIsAdmin(false)\r\n          setCart(res.data.cart)\r\n          setInfor([res.data.name, res.data.mobile, res.data.address])\r\n        } catch (err) {\r\n          swal(\"Error\", err.response.data.msg, \"error\")\r\n        }\r\n      }\r\n\r\n      getUser()\r\n    }\r\n  }, [token])\r\n\r\n  useEffect(() => {\r\n    if (token) {\r\n      const getHistory = async () => {\r\n        if (isAdmin) {\r\n          const res = await axios.get('/api/payment', {\r\n            headers: {Authorization: token}\r\n          })\r\n          setHistory(res.data)\r\n        } else {\r\n          const res = await axios.get('/user/history', {\r\n            headers: {Authorization: token}\r\n          })\r\n          setHistory(res.data)\r\n        }\r\n      }\r\n      getHistory()\r\n    }\r\n  }, [token, callback, isAdmin])\r\n\r\n  const addCart = async (product) => {\r\n    if (!isLogged) return swal(\"Fail!\", \"Please login to continue buying\", \"error\");\r\n\r\n    const check = cart.every(item => {\r\n      return item._id !== product._id\r\n    })\r\n    if (check) {\r\n      setCart([...cart, {...product, quantity: 1}])\r\n      await axios.patch('/user/addcart', {cart: [...cart, {...product, quantity: 1}]}, {\r\n        headers: {Authorization: token}\r\n      })\r\n    } else {\r\n      swal(\"Thank you!\", \"This product has been added to cart!\", \"info\");\r\n    }\r\n  } \r\n\r\n  return {\r\n    isLogged: [isLogged, setIsLogged],\r\n    isAdmin: [isAdmin, setIsAdmin],\r\n    cart: [cart, setCart],\r\n    addCart: addCart,\r\n    history: [history, setHistory],\r\n    callback: [callback, setCallback],\r\n    infor: [infor, setInfor]\r\n  }\r\n}\r\n\r\nexport default UserAPI\r\n"]},"metadata":{},"sourceType":"module"}